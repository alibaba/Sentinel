<div>
	<span class="brand" style="font-weight:bold;">{{paramFlowRuleDialog.title}}</span>
	<div class="card" style="margin-top: 20px;margin-bottom: 10px;">
		<div class="panel-body">
			<div class="clearfix">
				<form role="form" class="form-horizontal">
					<div class="form-group">
						<label class="col-sm-2 control-label">Resource Name</label>
						<div class="col-sm-9">
							<input type="text" ng-if="paramFlowRuleDialog.type == 'edit'" class="form-control" placeholder="resource name" ng-model='currentRule.rule.resource' disabled="" />
							<input type="text" ng-if="paramFlowRuleDialog.type == 'add'" class="form-control highlight-border" placeholder="resource name" ng-model='currentRule.rule.resource' required />
						</div>
                    </div>
                    
                    <div class="form-group">
						<label class="col-sm-2 control-label">Mode</label>
						<p class="col-sm-9 control-label" style="text-align: left; font-weight: normal;">QPS</p>
					</div>

					<div class="form-group">
						<label class="col-sm-2 control-label">Param Index</label>
						<div class="col-sm-9">
							<input type="number" class="form-control highlight-border" ng-model='currentRule.rule.paramIdx' placeholder='parameter index (start from 0)' />
						</div>
                    </div>
                    
                    <div class="form-group">
						<div ng-if="!currentRule.rule.clusterMode">
							<label class="col-sm-2 control-label">Single machine threshold</label>
							<div class="col-sm-3">
								<input type="number" class="form-control highlight-border" ng-model='currentRule.rule.count' placeholder='Single machine threshold' />
							</div>
							<label class="col-sm-3 control-label" title="The length of the statistical window, the unit is s">Statistics window duration</label>
							<div class="input-group col-sm-3">
								<input type="number" class="form-control highlight-border"
									   ng-model='currentRule.rule.durationInSec' min="1"
									   placeholder='Please fill in the duration of the statistics window (in seconds)' />
								<span class="input-group-addon">second</span>
							</div>
						</div>
						<div ng-if="currentRule.rule.clusterMode && currentRule.rule.clusterConfig.thresholdType == 0">
							<label class="col-sm-2 control-label">Amortization threshold</label>
							<div class="col-sm-9">
								<input type="number" class="form-control highlight-border" ng-model='currentRule.rule.count' placeholder='Cluster amortization threshold' />
							</div>
						</div>
						<div ng-if="currentRule.rule.clusterMode && currentRule.rule.clusterConfig.thresholdType == 1">
							<label class="col-sm-2 control-label">Cluster threshold</label>
							<div class="col-sm-9">
								<input type="number" class="form-control highlight-border" ng-model='currentRule.rule.count' placeholder='Cluster overall threshold' />
							</div>
						</div>
                    </div>

					<div class="form-group">
						<label class="col-sm-2 control-label">Whether to cluster</label>
						<div class="col-sm-2">
							<input type="checkbox" name="clusterMode" ng-model="currentRule.rule.clusterMode">
						</div>
						<div ng-if="currentRule.rule.clusterMode">
							<label class="col-sm-3 control-label">Cluster threshold mode</label>
							<div class="col-sm-4">
								<div class="form-control highlight-border" align="center">
									<input type="radio" name="clusterThresholdType" value="0" ng-model='currentRule.rule.clusterConfig.thresholdType' />&nbsp;Stand-alone share&nbsp;&nbsp;
									<input type="radio" name="clusterThresholdType" value="1" ng-model='currentRule.rule.clusterConfig.thresholdType' />&nbsp;Overall threshold
								</div>
							</div>
						</div>
					</div>

					<div class="form-group" ng-if="currentRule.rule.clusterMode">
						<label class="col-sm-2 control-label">Failure to degenerate</label>
						<div class="col-sm-8">
							<div class="checkbox-inline">
								<input type="checkbox" name="fallbackToLocalWhenFail"
									   ng-model="currentRule.rule.clusterConfig.fallbackToLocalWhenFail">
								<i class="glyphicon glyphicon-info-sign"></i>&nbsp;If selected, when the Token Server is unavailable, it will degenerate to a single-machine current limit
							</div>
						</div>
					</div>

                    <!-- exclusion item part start -->
					<div ng-if="!paramFlowRuleDialog.showAdvanceButton">
						<hr />
						<div class="form-group">
							<div class="form-group" style="text-align: center">
								<label class="control-label">Exception Items</label>
							</div>

							<div class="form-group">
								<label class="col-sm-2 control-label">Param Type</label>
								<div class="col-md-9">
									<select ng-model="curExItem.classType" ng-options="classType for classType in paramItemClassTypeList" class="form-control" placeholder="Choose parameter type...">
									</select>
								</div>
							</div>

							<div class="form-group">
								<label class="col-sm-2 control-label">Value</label>
								<div class="col-md-3">
									<input ng-model="curExItem.object" type="text" class="form-control" placeholder="item value">
								</div>

								<label class="col-sm-2 control-label">Threshold</label>
								<div class="col-md-3">
									<input type="number" ng-model="curExItem.count" class="form-control" placeholder="threshold">
								</div>

								<div class="col-md-2">
									<button type="button" class="btn btn-success"
											ng-disabled="notValidParamItem(curExItem)"
											ng-click="addParamItem()">
										<span class="fa fa-plus">&nbsp;Add</span>
									</button>
								</div>
							</div>

							<div>
								<div class="col-md-12">
									<table class="table table-condensed table-hover">
										<thead>
										<th>Item Value</th>
										<th>Item Type</th>
										<th>Threshold</th>
										<th>Operations</th>
										</thead>
										<tbody>
										<tr ng-repeat="paramItem in currentRule.rule.paramFlowItemList">
											<td><input ng-model="paramItem.object" type="text" class="form-control" placeholder="Param Item"></td>
											<td>
												<p>{{paramItem.classType}}</p>
											</td>
											<td>
												<input type="number" ng-model="paramItem.count" class="form-control" placeholder="Threshold">
											</td>
											<td>
												<button type="button" class="btn btn-danger"
														ng-click="removeParamItem(paramItem.object, paramItem.classType)"><span
														class="fa fa-trash-o">&nbsp;Remove</span></button>
											</td>
										</tr>
										</tbody>
									</table>
								</div>
							</div>

						</div>
					</div>

					<!-- exclusion item part end -->
					<div class="form-group text-center" ng-if="paramFlowRuleDialog.supportAdvanced">
						<a ng-click="onOpenAdvanceClick()" ng-if="paramFlowRuleDialog.showAdvanceButton" style="cursor: pointer;">Show Advanced Options</a>
						<a ng-click="onCloseAdvanceClick()" ng-if="!paramFlowRuleDialog.showAdvanceButton" style="cursor: pointer;">Hide Advanced Options</a>
					</div>
				</form>
			</div>
			<div class="separator"></div>
			<div clss="row" style="margin-top: 20px;">
				<button class="btn btn-outline-danger" style="float:right; height: 30px;font-size: 12px;margin-left: 10px;" ng-click="closeThisDialog()">Cancel</button>
				<button class="btn btn-outline-success" style="float:right; height: 30px;font-size: 12px;margin-left: 10px;" ng-click="saveRule()">{{paramFlowRuleDialog.confirmBtnText}}</button>
				<button ng-if="paramFlowRuleDialog.saveAndContinueBtnText" class="btn btn-default" style="float:right; height: 30px;font-size: 12px;"
				 ng-click="saveRuleAndContinue()">{{paramFlowRuleDialog.saveAndContinueBtnText}}</button>
			</div>
		</div>
	</div>
</div>
